---
# Path: .github/workflows/template-validation.yml
name: Template Validation

on:
  pull_request:
    branches: [ main, develop ]
    paths:
      - 'templates/**'
      - 'scripts/test-templates.*'
      - 'scripts/validate-nuget-metadata.*'
      - '.github/workflows/template-validation.yml'

  push:
    branches: [ main, develop ]
    paths:
      - 'templates/**'
      - 'scripts/test-templates.*'
      - 'scripts/validate-nuget-metadata.*'
      - '.github/workflows/template-validation.yml'

  workflow_dispatch:

permissions:
  contents: read

jobs:
  validate-templates:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup .NET SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: |
            6.0.x
            7.0.x
            8.0.x
            9.0.x
      
      - name: Make validation scripts executable
        run: |
          chmod +x scripts/test-templates.sh
          chmod +x scripts/validate-nuget-metadata.sh

      - name: Run comprehensive template tests
        run: ./scripts/test-templates.sh
        # This script handles template creation, build, and basic testing.
        # Its output includes a detailed report for easy debugging.

      - name: Run NuGet metadata validation
        run: ./scripts/validate-nuget-metadata.sh
        # This script specifically checks for correct NuGet metadata and
        # ensures no placeholders remain in the generated project.

      - name: Archive validation logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: template-validation-logs
          path: /tmp/template-validation/